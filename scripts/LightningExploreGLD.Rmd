---
title: "GLD Lightning data"
author: "Anna Talucci"
date: "2024-03-07"
output: html_document
---

# clear environment
```{r}
rm(list=ls())
```

# Overview

GLD Data 2016-2022

**What this script does**
This script 


# Packages

```{r}
library(tidyverse)
library(lubridate)
library(sf)
```

# Data
# Data

```{r}
eco = st_read("../data/spatialData/dire_ecoregs_caea/dire_ecoregs_caea.shp", "dire_ecoregs_caea")
```


## vector of data files
original data in "../data/GoogleDriveCsvFolder/"
```{r}
f <- list.files(path = "../data/lightningData/GLD/",
                pattern = "*.csv", full.names = TRUE)
```

```{r}
f
```

```{r}
( list2016 = f[c(1:12)] )
( list2017 = f[c(13:24)] )
( list2018 = f[c(25:36)] )
( list2019 = f[c(37:48)] )
( list2020 = f[c(49:60)] )
( list2021 = f[c(61:72)] )
( list2022 = f[c(73:84)] )

```


## Get Eco Projection

```{r}
st_crs(eco)
( ecozoneProjection = st_crs(eco)$proj4string )
```



# Functions

## Read into DF and Clean

```{r}
clean <- function(df){ 
  df %>% 
    map_dfr(read_csv) %>% 
  separate(time, c("date", "time"), sep = " ") %>%  
  mutate(date = ymd(date)) %>%
  dplyr::mutate(year = lubridate::year(date), 
                month = lubridate::month(date), 
                day = lubridate::day(date)) %>%
    filter(month %in% c(4,5,6,7, 8, 9, 10)) %>%
    filter(cloud=="FALSE") %>%
    select(date:latitude, year:day)
  
}
```


```{r}
( df2016 = list2016 %>% clean() )
( df2017 = list2017 %>% clean() )
( df2018 = list2018 %>% clean() )
( df2021 = list2021 %>% clean() )
( df2022 = list2022 %>% clean() )
```

```{r}
combine = bind_rows(df2016, df2017, df2018, df2021, df2022)
```

```{r}
combine
```

## Function to make points

```{r}
df_to_sf <- function(x){
  st_as_sf(x, coords = c("longitude","latitude"), crs = 4326, remove = FALSE)
}
```

## to point

```{r}
( gldpts = combine %>% df_to_sf() )
```

## Reproject To Project Projection

```{r}
gldEcoProj = st_transform(gldpts, crs=ecozoneProjection)
```

## write to shapefile

```{r eval=FALSE, include=FALSE}
st_write(gldEcoProj, "../outputs/spatialDataCreate/GLD16_18_21_22.shp", driver="ESRI Shapefile")
```